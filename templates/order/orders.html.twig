{% extends 'base.html.twig' %}

{% block title %}Liste des commandes
{% endblock %}

{% block stylesheets %}
	<link rel="stylesheet" href="{{ asset('css/main.css') }}">
{% endblock %}

{% block body %}

	<div class='container mb-5'>

		{# {{ dump(orders)}} #}
	
		{% if orders is empty %}
			<p class="mt-5" style="font-weight: bold; font-size: 18px;">Aucune commande enregistrée</p>

				{% else %}
					<h1>Liste des commandes</h1>

		{% endif %}

		{# Affichage des commandes #}

		{% for order in orders %}

		<h2 class="text-primary w-25 m-auto mt-5">Commande n°
			{{order.id }}
		</h2>

			{% if order.isCompleted == true %}
			<span class="text-success" style="font-weight: bold; font-size: 20px; background: #d4edda; padding: 2px;">Commande livrée</span>
			{% else %}
			<span class="text-danger" style="font-weight: bold; font-size: 18px; background: #f8d7da; padding: 2px;">Commande non livrée</span>
			{% endif %}
			<br>

			<p style="font-weight: bold; font-size: 18px; width:max-content; background: #cef4f5d0; padding: 2px;">Informations du client :
			</p>


			<table class="table table-bordered table-striped">
				<tbody>
					<tr>
						<th>Nom</th>
						<th>Prénom</th>
						<th>Téléphone</th>
						<th>Adresse</th>
						<th>Ville</th>
						<th>Crée le :</th>
						<th>Produit(s) acheté(s)</th>
					</tr>

					<tr>
						<td style="font-size: 18px;">{{ order.lastName }}</td>
						<td style="font-size: 18px;">{{ order.firstName }}</td>
						<td style="font-size: 18px;">{{ order.phone }}</td>
						<td style="font-size: 18px;">{{ order.adress }}</td>
						<td style="font-size: 18px;">{{ order.city.name }}</td>
						<td>{{ order.createdAt | date('d-m-y H:i')}}</td>

						<td style="font-size: 18px;">{% for orderProduct in order.getOrderProducts() %}	
							{{ orderProduct.getProduct().getName() }} (x{{ orderProduct.getQuantity() }}) <br>
						{% endfor %}
					</td>

					</tr>
				</tbody>
			</table>

			<h5>Frais de livraison :
				{{ order.city.shippingCost}}
			</h5>
			<h5 class='mb-5'>Total à payer :
				{{order.totalPrice + order.city.shippingCost}}
			</h5>
			<a class='btn btn-secondary' href="{{ path('app_bill',{'id':order.id}) }}">Imprimer la facture</a>

			{% if order.isCompleted != true %}
				<a href="{{ path('app_orders_is-completed-update', {'id':order.id}) }}" class='btn btn-success'>Marquer comme livrée</a>
			{% endif %}

			{% if type is not empty %}
				<a onclick="return confirm('Etes-vous sûr de vouloir supprimer cette commande ?');" class="btn btn-danger" href="{{ path ('app_orders_delete_type', {'id':order.id, 'type':type}) }}" class='btn btn-danger'>
					Supprimer la commande</a>
			{% else %}

				<a onclick="return confirm('Etes-vous sûr de vouloir supprimer cette commande ?');" class="btn btn-danger" href="{{ path ('app_orders_delete', {'id':order.id}) }}" class='btn btn-danger'>
					Supprimer la commande</a>
			{% endif %}

		{% endfor %}

		{{ knp_pagination_render(orders, 'layouts/_paginator.html.twig') }}

	</div>

{% endblock %}
